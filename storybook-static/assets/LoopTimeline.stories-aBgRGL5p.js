import{j as u}from"./jsx-runtime-u17CrQMm.js";import{r as c,R as q}from"./iframe-C3dj3Pg4.js";import{r as Ze}from"./index-C6c0_bsd.js";import"./preload-helper-PPVm8Dsz.js";import"./index-UihXAD4G.js";const jn=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();const pr=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const mr=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase());const on=e=>{const t=mr(e);return t.charAt(0).toUpperCase()+t.slice(1)};var hr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const gr=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0;return!1};const vr=c.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:s,iconNode:i,...a},l)=>c.createElement("svg",{ref:l,...hr,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:jn("lucide",o),...!s&&!gr(a)&&{"aria-hidden":"true"},...a},[...i.map(([d,p])=>c.createElement(d,p)),...Array.isArray(s)?s:[s]]));const G=(e,t)=>{const n=c.forwardRef(({className:r,...o},s)=>c.createElement(vr,{ref:s,iconNode:t,className:jn(`lucide-${pr(on(e))}`,`lucide-${e}`,r),...o}));return n.displayName=on(e),n};const br=[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]],yr=G("fast-forward",br);const xr=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Sr=G("maximize-2",xr);const wr=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Cr=G("maximize",wr);const Rr=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Mr=G("minimize-2",Rr);const Er=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],sn=G("pause",Er);const Nr=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],an=G("play",Nr);const Dr=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],kr=G("repeat",Dr);const jr=[["path",{d:"M12 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 12 18z",key:"2a1g8i"}],["path",{d:"M22 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 22 18z",key:"rg3s36"}]],Tr=G("rewind",jr);const Ir=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],Pr=G("skip-back",Ir);const Ar=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Br=G("skip-forward",Ar);const Or=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Tn=G("square-pen",Or);const zr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Lr=G("square",zr);const _r=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],$r=G("x",_r);const Fr=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Hr=G("zoom-in",Fr);const qr=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Wr=G("zoom-out",qr);function Ur(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const Et=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function He(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Wt(e){return"nodeType"in e}function ne(e){var t,n;return e?He(e)?e:Wt(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Ut(e){const{Document:t}=ne(e);return e instanceof t}function it(e){return He(e)?!1:e instanceof ne(e).HTMLElement}function In(e){return e instanceof ne(e).SVGElement}function qe(e){return e?He(e)?e.document:Wt(e)?Ut(e)?e:it(e)||In(e)?e.ownerDocument:document:document:document}const we=Et?c.useLayoutEffect:c.useEffect;function Vt(e){const t=c.useRef(e);return we(()=>{t.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Vr(){const e=c.useRef(null),t=c.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function rt(e,t){t===void 0&&(t=[e]);const n=c.useRef(e);return we(()=>{n.current!==e&&(n.current=e)},t),n}function at(e,t){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function St(e){const t=Vt(e),n=c.useRef(null),r=c.useCallback(o=>{o!==n.current&&t?.(o,n.current),n.current=o},[]);return[n,r]}function zt(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let It={};function ct(e,t){return c.useMemo(()=>{if(t)return t;const n=It[e]==null?0:It[e]+1;return It[e]=n,e+"-"+n},[e,t])}function Pn(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((s,i)=>{const a=Object.entries(i);for(const[l,d]of a){const p=s[l];p!=null&&(s[l]=p+e*d)}return s},{...t})}}const Fe=Pn(1),wt=Pn(-1);function Kr(e){return"clientX"in e&&"clientY"in e}function Kt(e){if(!e)return!1;const{KeyboardEvent:t}=ne(e.target);return t&&e instanceof t}function Xr(e){if(!e)return!1;const{TouchEvent:t}=ne(e.target);return t&&e instanceof t}function Lt(e){if(Xr(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Kr(e)?{x:e.clientX,y:e.clientY}:null}const ot=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[ot.Translate.toString(e),ot.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),cn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Yr(e){return e.matches(cn)?e:e.querySelector(cn)}const Jr={display:"none"};function Gr(e){let{id:t,value:n}=e;return q.createElement("div",{id:t,style:Jr},n)}function Zr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return q.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function Qr(){const[e,t]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const An=c.createContext(null);function eo(e){const t=c.useContext(An);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function to(){const[e]=c.useState(()=>new Set),t=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:o,event:s}=r;e.forEach(i=>{var a;return(a=i[o])==null?void 0:a.call(i,s)})},[e]),t]}const no={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ro={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function oo(e){let{announcements:t=ro,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=no}=e;const{announce:s,announcement:i}=Qr(),a=ct("DndLiveRegion"),[l,d]=c.useState(!1);if(c.useEffect(()=>{d(!0)},[]),eo(c.useMemo(()=>({onDragStart(f){let{active:x}=f;s(t.onDragStart({active:x}))},onDragMove(f){let{active:x,over:m}=f;t.onDragMove&&s(t.onDragMove({active:x,over:m}))},onDragOver(f){let{active:x,over:m}=f;s(t.onDragOver({active:x,over:m}))},onDragEnd(f){let{active:x,over:m}=f;s(t.onDragEnd({active:x,over:m}))},onDragCancel(f){let{active:x,over:m}=f;s(t.onDragCancel({active:x,over:m}))}}),[s,t])),!l)return null;const p=q.createElement(q.Fragment,null,q.createElement(Gr,{id:r,value:o.draggable}),q.createElement(Zr,{id:a,announcement:i}));return n?Ze.createPortal(p,n):p}var _;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(_||(_={}));function Ct(){}const he=Object.freeze({x:0,y:0});function so(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function io(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function ao(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function co(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function ln(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const lo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=ln(t,t.left,t.top),s=[];for(const i of r){const{id:a}=i,l=n.get(a);if(l){const d=so(ln(l),o);s.push({id:a,data:{droppableContainer:i,value:d}})}}return s.sort(io)};function uo(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),i=o-r,a=s-n;if(r<o&&n<s){const l=t.width*t.height,d=e.width*e.height,p=i*a,f=p/(l+d-p);return Number(f.toFixed(4))}return 0}const fo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const s of r){const{id:i}=s,a=n.get(i);if(a){const l=uo(a,t);l>0&&o.push({id:i,data:{droppableContainer:s,value:l}})}}return o.sort(ao)};function po(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Bn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:he}function mo(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o.reduce((i,a)=>({...i,top:i.top+e*a.y,bottom:i.bottom+e*a.y,left:i.left+e*a.x,right:i.right+e*a.x}),{...n})}}const ho=mo(1);function go(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function vo(e,t,n){const r=go(t);if(!r)return e;const{scaleX:o,scaleY:s,x:i,y:a}=r,l=e.left-i-(1-o)*parseFloat(n),d=e.top-a-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),p=o?e.width/o:e.width,f=s?e.height/s:e.height;return{width:p,height:f,top:d,right:l+p,bottom:d+f,left:l}}const bo={ignoreTransform:!1};function We(e,t){t===void 0&&(t=bo);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:p}=ne(e).getComputedStyle(e);d&&(n=vo(n,d,p))}const{top:r,left:o,width:s,height:i,bottom:a,right:l}=n;return{top:r,left:o,width:s,height:i,bottom:a,right:l}}function un(e){return We(e,{ignoreTransform:!0})}function yo(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function xo(e,t){return t===void 0&&(t=ne(e).getComputedStyle(e)),t.position==="fixed"}function So(e,t){t===void 0&&(t=ne(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const s=t[o];return typeof s=="string"?n.test(s):!1})}function Xt(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(Ut(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!it(o)||In(o)||n.includes(o))return n;const s=ne(e).getComputedStyle(o);return o!==e&&So(o,s)&&n.push(o),xo(o,s)?n:r(o.parentNode)}return e?r(e):n}function On(e){const[t]=Xt(e,1);return t??null}function Pt(e){return!Et||!e?null:He(e)?e:Wt(e)?Ut(e)||e===qe(e).scrollingElement?window:it(e)?e:null:null}function zn(e){return He(e)?e.scrollX:e.scrollLeft}function Ln(e){return He(e)?e.scrollY:e.scrollTop}function _t(e){return{x:zn(e),y:Ln(e)}}var H;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(H||(H={}));function _n(e){return!Et||!e?!1:e===document.scrollingElement}function $n(e){const t={x:0,y:0},n=_n(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,i=e.scrollTop>=r.y,a=e.scrollLeft>=r.x;return{isTop:o,isLeft:s,isBottom:i,isRight:a,maxScroll:r,minScroll:t}}const wo={x:.2,y:.2};function Co(e,t,n,r,o){let{top:s,left:i,right:a,bottom:l}=n;r===void 0&&(r=10),o===void 0&&(o=wo);const{isTop:d,isBottom:p,isLeft:f,isRight:x}=$n(e),m={x:0,y:0},h={x:0,y:0},b={height:t.height*o.y,width:t.width*o.x};return!d&&s<=t.top+b.height?(m.y=H.Backward,h.y=r*Math.abs((t.top+b.height-s)/b.height)):!p&&l>=t.bottom-b.height&&(m.y=H.Forward,h.y=r*Math.abs((t.bottom-b.height-l)/b.height)),!x&&a>=t.right-b.width?(m.x=H.Forward,h.x=r*Math.abs((t.right-b.width-a)/b.width)):!f&&i<=t.left+b.width&&(m.x=H.Backward,h.x=r*Math.abs((t.left+b.width-i)/b.width)),{direction:m,speed:h}}function Ro(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:i}=window;return{top:0,left:0,right:s,bottom:i,width:s,height:i}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Fn(e){return e.reduce((t,n)=>Fe(t,_t(n)),he)}function Mo(e){return e.reduce((t,n)=>t+zn(n),0)}function Eo(e){return e.reduce((t,n)=>t+Ln(n),0)}function No(e,t){if(t===void 0&&(t=We),!e)return;const{top:n,left:r,bottom:o,right:s}=t(e);On(e)&&(o<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Do=[["x",["left","right"],Mo],["y",["top","bottom"],Eo]];class Yt{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Xt(n),o=Fn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,i,a]of Do)for(const l of i)Object.defineProperty(this,l,{get:()=>{const d=a(r),p=o[s]-d;return this.rect[l]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Qe{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function ko(e){const{EventTarget:t}=ne(e);return e instanceof t?e:qe(e)}function At(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var pe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(pe||(pe={}));function dn(e){e.preventDefault()}function jo(e){e.stopPropagation()}var P;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(P||(P={}));const Hn={start:[P.Space,P.Enter],cancel:[P.Esc],end:[P.Space,P.Enter,P.Tab]},To=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case P.Right:return{...n,x:n.x+25};case P.Left:return{...n,x:n.x-25};case P.Down:return{...n,y:n.y+25};case P.Up:return{...n,y:n.y-25}}};class qn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Qe(qe(n)),this.windowListeners=new Qe(ne(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&No(r),n(he)}handleKeyDown(t){if(Kt(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:s=Hn,coordinateGetter:i=To,scrollBehavior:a="smooth"}=o,{code:l}=t;if(s.end.includes(l)){this.handleEnd(t);return}if(s.cancel.includes(l)){this.handleCancel(t);return}const{collisionRect:d}=r.current,p=d?{x:d.left,y:d.top}:he;this.referenceCoordinates||(this.referenceCoordinates=p);const f=i(t,{active:n,context:r.current,currentCoordinates:p});if(f){const x=wt(f,p),m={x:0,y:0},{scrollableAncestors:h}=r.current;for(const b of h){const g=t.code,{isTop:C,isRight:S,isLeft:R,isBottom:y,maxScroll:v,minScroll:M}=$n(b),D=Ro(b),N={x:Math.min(g===P.Right?D.right-D.width/2:D.right,Math.max(g===P.Right?D.left:D.left+D.width/2,f.x)),y:Math.min(g===P.Down?D.bottom-D.height/2:D.bottom,Math.max(g===P.Down?D.top:D.top+D.height/2,f.y))},T=g===P.Right&&!S||g===P.Left&&!R,I=g===P.Down&&!y||g===P.Up&&!C;if(T&&N.x!==f.x){const E=b.scrollLeft+x.x,Z=g===P.Right&&E<=v.x||g===P.Left&&E>=M.x;if(Z&&!x.y){b.scrollTo({left:E,behavior:a});return}Z?m.x=b.scrollLeft-E:m.x=g===P.Right?b.scrollLeft-v.x:b.scrollLeft-M.x,m.x&&b.scrollBy({left:-m.x,behavior:a});break}else if(I&&N.y!==f.y){const E=b.scrollTop+x.y,Z=g===P.Down&&E<=v.y||g===P.Up&&E>=M.y;if(Z&&!x.x){b.scrollTo({top:E,behavior:a});return}Z?m.y=b.scrollTop-E:m.y=g===P.Down?b.scrollTop-v.y:b.scrollTop-M.y,m.y&&b.scrollBy({top:-m.y,behavior:a});break}}this.handleMove(t,Fe(wt(f,this.referenceCoordinates),m))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}qn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Hn,onActivation:o}=t,{active:s}=n;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const a=s.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function fn(e){return!!(e&&"distance"in e)}function pn(e){return!!(e&&"delay"in e)}class Jt{constructor(t,n,r){var o;r===void 0&&(r=ko(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:i}=s;this.props=t,this.events=n,this.document=qe(i),this.documentListeners=new Qe(this.document),this.listeners=new Qe(r),this.windowListeners=new Qe(ne(i)),this.initialCoordinates=(o=Lt(s))!=null?o:he,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.DragStart,dn),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),this.windowListeners.add(pe.ContextMenu,dn),this.documentListeners.add(pe.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(pn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(fn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(pe.Click,jo,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pe.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:s}=this,{onMove:i,options:{activationConstraint:a}}=s;if(!o)return;const l=(n=Lt(t))!=null?n:he,d=wt(o,l);if(!r&&a){if(fn(a)){if(a.tolerance!=null&&At(d,a.tolerance))return this.handleCancel();if(At(d,a.distance))return this.handleStart()}if(pn(a)&&At(d,a.tolerance))return this.handleCancel();this.handlePending(a,d);return}t.cancelable&&t.preventDefault(),i(l)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===P.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Io={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Wn extends Jt{constructor(t){const{event:n}=t,r=qe(n.target);super(t,Io,r)}}Wn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const Po={move:{name:"mousemove"},end:{name:"mouseup"}};var $t;(function(e){e[e.RightClick=2]="RightClick"})($t||($t={}));class Ao extends Jt{constructor(t){super(t,Po,qe(t.event.target))}}Ao.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===$t.RightClick?!1:(r?.({event:n}),!0)}}];const Bt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Bo extends Jt{constructor(t){super(t,Bt)}static setup(){return window.addEventListener(Bt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Bt.move.name,t)};function t(){}}}Bo.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r?.({event:n}),!0)}}];var et;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(et||(et={}));var Rt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Rt||(Rt={}));function Oo(e){let{acceleration:t,activator:n=et.Pointer,canScroll:r,draggingRect:o,enabled:s,interval:i=5,order:a=Rt.TreeOrder,pointerCoordinates:l,scrollableAncestors:d,scrollableAncestorRects:p,delta:f,threshold:x}=e;const m=Lo({delta:f,disabled:!s}),[h,b]=Vr(),g=c.useRef({x:0,y:0}),C=c.useRef({x:0,y:0}),S=c.useMemo(()=>{switch(n){case et.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case et.DraggableRect:return o}},[n,o,l]),R=c.useRef(null),y=c.useCallback(()=>{const M=R.current;if(!M)return;const D=g.current.x*C.current.x,N=g.current.y*C.current.y;M.scrollBy(D,N)},[]),v=c.useMemo(()=>a===Rt.TreeOrder?[...d].reverse():d,[a,d]);c.useEffect(()=>{if(!s||!d.length||!S){b();return}for(const M of v){if(r?.(M)===!1)continue;const D=d.indexOf(M),N=p[D];if(!N)continue;const{direction:T,speed:I}=Co(M,N,S,t,x);for(const E of["x","y"])m[E][T[E]]||(I[E]=0,T[E]=0);if(I.x>0||I.y>0){b(),R.current=M,h(y,i),g.current=I,C.current=T;return}}g.current={x:0,y:0},C.current={x:0,y:0},b()},[t,y,r,b,s,i,JSON.stringify(S),JSON.stringify(m),h,d,v,p,JSON.stringify(x)])}const zo={x:{[H.Backward]:!1,[H.Forward]:!1},y:{[H.Backward]:!1,[H.Forward]:!1}};function Lo(e){let{delta:t,disabled:n}=e;const r=zt(t);return at(o=>{if(n||!r||!o)return zo;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[H.Backward]:o.x[H.Backward]||s.x===-1,[H.Forward]:o.x[H.Forward]||s.x===1},y:{[H.Backward]:o.y[H.Backward]||s.y===-1,[H.Forward]:o.y[H.Forward]||s.y===1}}},[n,t,r])}function _o(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return at(o=>{var s;return t==null?null:(s=r??o)!=null?s:null},[r,t])}function $o(e,t){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,s=o.activators.map(i=>({eventName:i.eventName,handler:t(i.handler,r)}));return[...n,...s]},[]),[e,t])}var st;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(st||(st={}));var Ft;(function(e){e.Optimized="optimized"})(Ft||(Ft={}));const mn=new Map;function Fo(e,t){let{dragging:n,dependencies:r,config:o}=t;const[s,i]=c.useState(null),{frequency:a,measure:l,strategy:d}=o,p=c.useRef(e),f=g(),x=rt(f),m=c.useCallback(function(C){C===void 0&&(C=[]),!x.current&&i(S=>S===null?C:S.concat(C.filter(R=>!S.includes(R))))},[x]),h=c.useRef(null),b=at(C=>{if(f&&!n)return mn;if(!C||C===mn||p.current!==e||s!=null){const S=new Map;for(let R of e){if(!R)continue;if(s&&s.length>0&&!s.includes(R.id)&&R.rect.current){S.set(R.id,R.rect.current);continue}const y=R.node.current,v=y?new Yt(l(y),y):null;R.rect.current=v,v&&S.set(R.id,v)}return S}return C},[e,s,n,f,l]);return c.useEffect(()=>{p.current=e},[e]),c.useEffect(()=>{f||m()},[n,f]),c.useEffect(()=>{s&&s.length>0&&i(null)},[JSON.stringify(s)]),c.useEffect(()=>{f||typeof a!="number"||h.current!==null||(h.current=setTimeout(()=>{m(),h.current=null},a))},[a,f,m,...r]),{droppableRects:b,measureDroppableContainers:m,measuringScheduled:s!=null};function g(){switch(d){case st.Always:return!1;case st.BeforeDragging:return n;default:return!n}}}function Un(e,t){return at(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Ho(e,t){return Un(e,t)}function qo(e){let{callback:t,disabled:n}=e;const r=Vt(t),o=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(r)},[r,n]);return c.useEffect(()=>()=>o?.disconnect(),[o]),o}function Nt(e){let{callback:t,disabled:n}=e;const r=Vt(t),o=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(r)},[n]);return c.useEffect(()=>()=>o?.disconnect(),[o]),o}function Wo(e){return new Yt(We(e),e)}function hn(e,t,n){t===void 0&&(t=Wo);const[r,o]=c.useState(null);function s(){o(l=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=l??n)!=null?d:null}const p=t(e);return JSON.stringify(l)===JSON.stringify(p)?l:p})}const i=qo({callback(l){if(e)for(const d of l){const{type:p,target:f}=d;if(p==="childList"&&f instanceof HTMLElement&&f.contains(e)){s();break}}}}),a=Nt({callback:s});return we(()=>{s(),e?(a?.observe(e),i?.observe(document.body,{childList:!0,subtree:!0})):(a?.disconnect(),i?.disconnect())},[e]),r}function Uo(e){const t=Un(e);return Bn(e,t)}const gn=[];function Vo(e){const t=c.useRef(e),n=at(r=>e?r&&r!==gn&&e&&t.current&&e.parentNode===t.current.parentNode?r:Xt(e):gn,[e]);return c.useEffect(()=>{t.current=e},[e]),n}function Ko(e){const[t,n]=c.useState(null),r=c.useRef(e),o=c.useCallback(s=>{const i=Pt(s.target);i&&n(a=>a?(a.set(i,_t(i)),new Map(a)):null)},[]);return c.useEffect(()=>{const s=r.current;if(e!==s){i(s);const a=e.map(l=>{const d=Pt(l);return d?(d.addEventListener("scroll",o,{passive:!0}),[d,_t(d)]):null}).filter(l=>l!=null);n(a.length?new Map(a):null),r.current=e}return()=>{i(e),i(s)};function i(a){a.forEach(l=>{const d=Pt(l);d?.removeEventListener("scroll",o)})}},[o,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,i)=>Fe(s,i),he):Fn(e):he,[e,t])}function vn(e,t){t===void 0&&(t=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},t),c.useEffect(()=>{const r=e!==he;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?wt(e,n.current):he}function Xo(e){c.useEffect(()=>{if(!Et)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function Yo(e,t){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:s}=r;return n[o]=i=>{s(i,t)},n},{}),[e,t])}function Vn(e){return c.useMemo(()=>e?yo(e):null,[e])}const bn=[];function Jo(e,t){t===void 0&&(t=We);const[n]=e,r=Vn(n?ne(n):null),[o,s]=c.useState(bn);function i(){s(()=>e.length?e.map(l=>_n(l)?r:new Yt(t(l),l)):bn)}const a=Nt({callback:i});return we(()=>{a?.disconnect(),i(),e.forEach(l=>a?.observe(l))},[e]),o}function Go(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return it(t)?t:e}function Zo(e){let{measure:t}=e;const[n,r]=c.useState(null),o=c.useCallback(d=>{for(const{target:p}of d)if(it(p)){r(f=>{const x=t(p);return f?{...f,width:x.width,height:x.height}:x});break}},[t]),s=Nt({callback:o}),i=c.useCallback(d=>{const p=Go(d);s?.disconnect(),p&&s?.observe(p),r(p?t(p):null)},[t,s]),[a,l]=St(i);return c.useMemo(()=>({nodeRef:a,rect:n,setRef:l}),[n,a,l])}const Qo=[{sensor:Wn,options:{}},{sensor:qn,options:{}}],es={current:{}},xt={draggable:{measure:un},droppable:{measure:un,strategy:st.WhileDragging,frequency:Ft.Optimized},dragOverlay:{measure:We}};class tt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const ts={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new tt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ct},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:xt,measureDroppableContainers:Ct,windowRect:null,measuringScheduled:!1},ns={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ct,draggableNodes:new Map,over:null,measureDroppableContainers:Ct},Dt=c.createContext(ns),Kn=c.createContext(ts);function rs(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new tt}}}function os(e,t){switch(t.type){case _.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case _.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case _.DragEnd:case _.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case _.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new tt(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case _.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const i=new tt(e.droppable.containers);return i.set(n,{...s,disabled:o}),{...e,droppable:{...e.droppable,containers:i}}}case _.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const s=new tt(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function ss(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=c.useContext(Dt),s=zt(r),i=zt(n?.id);return c.useEffect(()=>{if(!t&&!r&&s&&i!=null){if(!Kt(s)||document.activeElement===s.target)return;const a=o.get(i);if(!a)return;const{activatorNode:l,node:d}=a;if(!l.current&&!d.current)return;requestAnimationFrame(()=>{for(const p of[l.current,d.current]){if(!p)continue;const f=Yr(p);if(f){f.focus();break}}})}},[r,t,o,i,s]),null}function is(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,s)=>s({transform:o,...r}),n):n}function as(e){return c.useMemo(()=>({draggable:{...xt.draggable,...e?.draggable},droppable:{...xt.droppable,...e?.droppable},dragOverlay:{...xt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function cs(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const s=c.useRef(!1),{x:i,y:a}=typeof o=="boolean"?{x:o,y:o}:o;we(()=>{if(!i&&!a||!t){s.current=!1;return}if(s.current||!r)return;const d=t?.node.current;if(!d||d.isConnected===!1)return;const p=n(d),f=Bn(p,r);if(i||(f.x=0),a||(f.y=0),s.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const x=On(d);x&&x.scrollBy({top:f.y,left:f.x})}},[t,i,a,r,n])}const Xn=c.createContext({...he,scaleX:1,scaleY:1});var Ie;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ie||(Ie={}));const ls=c.memo(function(t){var n,r,o,s;let{id:i,accessibility:a,autoScroll:l=!0,children:d,sensors:p=Qo,collisionDetection:f=fo,measuring:x,modifiers:m,...h}=t;const b=c.useReducer(os,void 0,rs),[g,C]=b,[S,R]=to(),[y,v]=c.useState(Ie.Uninitialized),M=y===Ie.Initialized,{draggable:{active:D,nodes:N,translate:T},droppable:{containers:I}}=g,E=D!=null?N.get(D):null,Z=c.useRef({initial:null,translated:null}),X=c.useMemo(()=>{var K;return D!=null?{id:D,data:(K=E?.data)!=null?K:es,rect:Z}:null},[D,E]),ce=c.useRef(null),[V,W]=c.useState(null),[B,Pe]=c.useState(null),le=rt(h,Object.values(h)),ge=ct("DndDescribedBy",i),Me=c.useMemo(()=>I.getEnabled(),[I]),$=as(x),{droppableRects:ue,measureDroppableContainers:me,measuringScheduled:ve}=Fo(Me,{dragging:M,dependencies:[T.x,T.y],config:$.droppable}),Y=_o(N,D),Ee=c.useMemo(()=>B?Lt(B):null,[B]),Q=fr(),re=Ho(Y,$.draggable.measure);cs({activeNode:D!=null?N.get(D):null,config:Q.layoutShiftCompensation,initialRect:re,measure:$.draggable.measure});const A=hn(Y,$.draggable.measure,re),Ae=hn(Y?Y.parentElement:null),de=c.useRef({activatorEvent:null,active:null,activeNode:Y,collisionRect:null,collisions:null,droppableRects:ue,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:I,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ne=I.getNodeFor((n=de.current.over)==null?void 0:n.id),w=Zo({measure:$.dragOverlay.measure}),k=(r=w.nodeRef.current)!=null?r:Y,j=M?(o=w.rect)!=null?o:A:null,O=!!(w.nodeRef.current&&w.rect),F=Uo(O?null:A),J=Vn(k?ne(k):null),L=Vo(M?Ne??Y:null),be=Jo(L),ee=is(m,{transform:{x:T.x-F.x,y:T.y-F.y,scaleX:1,scaleY:1},activatorEvent:B,active:X,activeNodeRect:A,containerNodeRect:Ae,draggingNodeRect:j,over:de.current.over,overlayNodeRect:w.rect,scrollableAncestors:L,scrollableAncestorRects:be,windowRect:J}),ye=Ee?Fe(Ee,T):null,oe=Ko(L),Ue=vn(oe),Ve=vn(oe,[A]),Be=Fe(ee,Ue),_e=j?ho(j,ee):null,Ke=X&&_e?f({active:X,collisionRect:_e,droppableRects:ue,droppableContainers:Me,pointerCoordinates:ye}):null,en=co(Ke,"id"),[De,tn]=c.useState(null),ar=O?ee:Fe(ee,Ve),cr=po(ar,(s=De?.rect)!=null?s:null,A),jt=c.useRef(null),nn=c.useCallback((K,se)=>{let{sensor:ie,options:ke}=se;if(ce.current==null)return;const fe=N.get(ce.current);if(!fe)return;const ae=K.nativeEvent,xe=new ie({active:ce.current,activeNode:fe,event:ae,options:ke,context:de,onAbort(U){if(!N.get(U))return;const{onDragAbort:Se}=le.current,Re={id:U};Se?.(Re),S({type:"onDragAbort",event:Re})},onPending(U,je,Se,Re){if(!N.get(U))return;const{onDragPending:Ye}=le.current,Te={id:U,constraint:je,initialCoordinates:Se,offset:Re};Ye?.(Te),S({type:"onDragPending",event:Te})},onStart(U){const je=ce.current;if(je==null)return;const Se=N.get(je);if(!Se)return;const{onDragStart:Re}=le.current,Xe={activatorEvent:ae,active:{id:je,data:Se.data,rect:Z}};Ze.unstable_batchedUpdates(()=>{Re?.(Xe),v(Ie.Initializing),C({type:_.DragStart,initialCoordinates:U,active:je}),S({type:"onDragStart",event:Xe}),W(jt.current),Pe(ae)})},onMove(U){C({type:_.DragMove,coordinates:U})},onEnd:$e(_.DragEnd),onCancel:$e(_.DragCancel)});jt.current=xe;function $e(U){return async function(){const{active:Se,collisions:Re,over:Xe,scrollAdjustedTranslate:Ye}=de.current;let Te=null;if(Se&&Ye){const{cancelDrop:Je}=le.current;Te={activatorEvent:ae,active:Se,collisions:Re,delta:Ye,over:Xe},U===_.DragEnd&&typeof Je=="function"&&await Promise.resolve(Je(Te))&&(U=_.DragCancel)}ce.current=null,Ze.unstable_batchedUpdates(()=>{C({type:U}),v(Ie.Uninitialized),tn(null),W(null),Pe(null),jt.current=null;const Je=U===_.DragEnd?"onDragEnd":"onDragCancel";if(Te){const Tt=le.current[Je];Tt?.(Te),S({type:Je,event:Te})}})}}},[N]),lr=c.useCallback((K,se)=>(ie,ke)=>{const fe=ie.nativeEvent,ae=N.get(ke);if(ce.current!==null||!ae||fe.dndKit||fe.defaultPrevented)return;const xe={active:ae};K(ie,se.options,xe)===!0&&(fe.dndKit={capturedBy:se.sensor},ce.current=ke,nn(ie,se))},[N,nn]),rn=$o(p,lr);Xo(p),we(()=>{A&&y===Ie.Initializing&&v(Ie.Initialized)},[A,y]),c.useEffect(()=>{const{onDragMove:K}=le.current,{active:se,activatorEvent:ie,collisions:ke,over:fe}=de.current;if(!se||!ie)return;const ae={active:se,activatorEvent:ie,collisions:ke,delta:{x:Be.x,y:Be.y},over:fe};Ze.unstable_batchedUpdates(()=>{K?.(ae),S({type:"onDragMove",event:ae})})},[Be.x,Be.y]),c.useEffect(()=>{const{active:K,activatorEvent:se,collisions:ie,droppableContainers:ke,scrollAdjustedTranslate:fe}=de.current;if(!K||ce.current==null||!se||!fe)return;const{onDragOver:ae}=le.current,xe=ke.get(en),$e=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,U={active:K,activatorEvent:se,collisions:ie,delta:{x:fe.x,y:fe.y},over:$e};Ze.unstable_batchedUpdates(()=>{tn($e),ae?.(U),S({type:"onDragOver",event:U})})},[en]),we(()=>{de.current={activatorEvent:B,active:X,activeNode:Y,collisionRect:_e,collisions:Ke,droppableRects:ue,draggableNodes:N,draggingNode:k,draggingNodeRect:j,droppableContainers:I,over:De,scrollableAncestors:L,scrollAdjustedTranslate:Be},Z.current={initial:j,translated:_e}},[X,Y,Ke,_e,N,k,j,ue,I,De,L,Be]),Oo({...Q,delta:T,draggingRect:_e,pointerCoordinates:ye,scrollableAncestors:L,scrollableAncestorRects:be});const ur=c.useMemo(()=>({active:X,activeNode:Y,activeNodeRect:A,activatorEvent:B,collisions:Ke,containerNodeRect:Ae,dragOverlay:w,draggableNodes:N,droppableContainers:I,droppableRects:ue,over:De,measureDroppableContainers:me,scrollableAncestors:L,scrollableAncestorRects:be,measuringConfiguration:$,measuringScheduled:ve,windowRect:J}),[X,Y,A,B,Ke,Ae,w,N,I,ue,De,me,L,be,$,ve,J]),dr=c.useMemo(()=>({activatorEvent:B,activators:rn,active:X,activeNodeRect:A,ariaDescribedById:{draggable:ge},dispatch:C,draggableNodes:N,over:De,measureDroppableContainers:me}),[B,rn,X,A,C,ge,N,De,me]);return q.createElement(An.Provider,{value:R},q.createElement(Dt.Provider,{value:dr},q.createElement(Kn.Provider,{value:ur},q.createElement(Xn.Provider,{value:cr},d)),q.createElement(ss,{disabled:a?.restoreFocus===!1})),q.createElement(oo,{...a,hiddenTextDescribedById:ge}));function fr(){const K=V?.autoScrollEnabled===!1,se=typeof l=="object"?l.enabled===!1:l===!1,ie=M&&!K&&!se;return typeof l=="object"?{...l,enabled:ie}:{enabled:ie}}}),us=c.createContext(null),yn="button",ds="Draggable";function fs(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const s=ct(ds),{activators:i,activatorEvent:a,active:l,activeNodeRect:d,ariaDescribedById:p,draggableNodes:f,over:x}=c.useContext(Dt),{role:m=yn,roleDescription:h="draggable",tabIndex:b=0}=o??{},g=l?.id===t,C=c.useContext(g?Xn:us),[S,R]=St(),[y,v]=St(),M=Yo(i,t),D=rt(n);we(()=>(f.set(t,{id:t,key:s,node:S,activatorNode:y,data:D}),()=>{const T=f.get(t);T&&T.key===s&&f.delete(t)}),[f,t]);const N=c.useMemo(()=>({role:m,tabIndex:b,"aria-disabled":r,"aria-pressed":g&&m===yn?!0:void 0,"aria-roledescription":h,"aria-describedby":p.draggable}),[r,m,b,g,h,p.draggable]);return{active:l,activatorEvent:a,activeNodeRect:d,attributes:N,isDragging:g,listeners:r?void 0:M,node:S,over:x,setNodeRef:R,setActivatorNodeRef:v,transform:C}}function ps(){return c.useContext(Kn)}const ms="Droppable",hs={timeout:25};function gs(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const s=ct(ms),{active:i,dispatch:a,over:l,measureDroppableContainers:d}=c.useContext(Dt),p=c.useRef({disabled:n}),f=c.useRef(!1),x=c.useRef(null),m=c.useRef(null),{disabled:h,updateMeasurementsFor:b,timeout:g}={...hs,...o},C=rt(b??r),S=c.useCallback(()=>{if(!f.current){f.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{d(Array.isArray(C.current)?C.current:[C.current]),m.current=null},g)},[g]),R=Nt({callback:S,disabled:h||!i}),y=c.useCallback((N,T)=>{R&&(T&&(R.unobserve(T),f.current=!1),N&&R.observe(N))},[R]),[v,M]=St(y),D=rt(t);return c.useEffect(()=>{!R||!v.current||(R.disconnect(),f.current=!1,R.observe(v.current))},[v,R]),c.useEffect(()=>(a({type:_.RegisterDroppable,element:{id:r,key:s,disabled:n,node:v,rect:x,data:D}}),()=>a({type:_.UnregisterDroppable,key:s,id:r})),[r]),c.useEffect(()=>{n!==p.current.disabled&&(a({type:_.SetDroppableDisabled,id:r,key:s,disabled:n}),p.current.disabled=n)},[r,s,n,a]),{active:i,rect:x,isOver:l?.id===r,node:v,over:l,setNodeRef:M}}function Yn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function vs(e,t){return e.reduce((n,r,o)=>{const s=t.get(r);return s&&(n[o]=s),n},Array(e.length))}function lt(e){return e!==null&&e>=0}function bs(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ys(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Gt=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const s=Yn(t,r,n),i=t[o],a=s[o];return!a||!i?null:{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}},Jn="Sortable",Gn=q.createContext({activeIndex:-1,containerId:Jn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Gt,disabled:{draggable:!1,droppable:!1}});function xs(e){let{children:t,id:n,items:r,strategy:o=Gt,disabled:s=!1}=e;const{active:i,dragOverlay:a,droppableRects:l,over:d,measureDroppableContainers:p}=ps(),f=ct(Jn,n),x=a.rect!==null,m=c.useMemo(()=>r.map(M=>typeof M=="object"&&"id"in M?M.id:M),[r]),h=i!=null,b=i?m.indexOf(i.id):-1,g=d?m.indexOf(d.id):-1,C=c.useRef(m),S=!bs(m,C.current),R=g!==-1&&b===-1||S,y=ys(s);we(()=>{S&&h&&p(m)},[S,m,h,p]),c.useEffect(()=>{C.current=m},[m]);const v=c.useMemo(()=>({activeIndex:b,containerId:f,disabled:y,disableTransforms:R,items:m,overIndex:g,useDragOverlay:x,sortedRects:vs(m,l),strategy:o}),[b,f,y.draggable,y.droppable,R,m,g,l,x,o]);return q.createElement(Gn.Provider,{value:v},t)}const Ss=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return Yn(n,r,o).indexOf(t)},ws=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:s,newIndex:i,previousItems:a,previousContainerId:l,transition:d}=e;return!d||!r||a!==s&&o===i?!1:n?!0:i!==o&&t===l},Cs={duration:200,easing:"ease"},Zn="transform",Rs=ot.Transition.toString({property:Zn,duration:0,easing:"linear"}),Ms={roleDescription:"sortable"};function Es(e){let{disabled:t,index:n,node:r,rect:o}=e;const[s,i]=c.useState(null),a=c.useRef(n);return we(()=>{if(!t&&n!==a.current&&r.current){const l=o.current;if(l){const d=We(r.current,{ignoreTransform:!0}),p={x:l.left-d.left,y:l.top-d.top,scaleX:l.width/d.width,scaleY:l.height/d.height};(p.x||p.y)&&i(p)}}n!==a.current&&(a.current=n)},[t,n,r,o]),c.useEffect(()=>{s&&i(null)},[s]),s}function Ns(e){let{animateLayoutChanges:t=ws,attributes:n,disabled:r,data:o,getNewIndex:s=Ss,id:i,strategy:a,resizeObserverConfig:l,transition:d=Cs}=e;const{items:p,containerId:f,activeIndex:x,disabled:m,disableTransforms:h,sortedRects:b,overIndex:g,useDragOverlay:C,strategy:S}=c.useContext(Gn),R=Ds(r,m),y=p.indexOf(i),v=c.useMemo(()=>({sortable:{containerId:f,index:y,items:p},...o}),[f,o,y,p]),M=c.useMemo(()=>p.slice(p.indexOf(i)),[p,i]),{rect:D,node:N,isOver:T,setNodeRef:I}=gs({id:i,data:v,disabled:R.droppable,resizeObserverConfig:{updateMeasurementsFor:M,...l}}),{active:E,activatorEvent:Z,activeNodeRect:X,attributes:ce,setNodeRef:V,listeners:W,isDragging:B,over:Pe,setActivatorNodeRef:le,transform:ge}=fs({id:i,data:v,attributes:{...Ms,...n},disabled:R.draggable}),Me=Ur(I,V),$=!!E,ue=$&&!h&&lt(x)&&lt(g),me=!C&&B,ve=me&&ue?ge:null,Ee=ue?ve??(a??S)({rects:b,activeNodeRect:X,activeIndex:x,overIndex:g,index:y}):null,Q=lt(x)&&lt(g)?s({id:i,items:p,activeIndex:x,overIndex:g}):y,re=E?.id,A=c.useRef({activeId:re,items:p,newIndex:Q,containerId:f}),Ae=p!==A.current.items,de=t({active:E,containerId:f,isDragging:B,isSorting:$,id:i,index:y,items:p,newIndex:A.current.newIndex,previousItems:A.current.items,previousContainerId:A.current.containerId,transition:d,wasDragging:A.current.activeId!=null}),Ne=Es({disabled:!de,index:y,node:N,rect:D});return c.useEffect(()=>{$&&A.current.newIndex!==Q&&(A.current.newIndex=Q),f!==A.current.containerId&&(A.current.containerId=f),p!==A.current.items&&(A.current.items=p)},[$,Q,f,p]),c.useEffect(()=>{if(re===A.current.activeId)return;if(re!=null&&A.current.activeId==null){A.current.activeId=re;return}const k=setTimeout(()=>{A.current.activeId=re},50);return()=>clearTimeout(k)},[re]),{active:E,activeIndex:x,attributes:ce,data:v,rect:D,index:y,newIndex:Q,items:p,isOver:T,isSorting:$,isDragging:B,listeners:W,node:N,overIndex:g,over:Pe,setNodeRef:Me,setActivatorNodeRef:le,setDroppableNodeRef:I,setDraggableNodeRef:V,transform:Ne??Ee,transition:w()};function w(){if(Ne||Ae&&A.current.newIndex===y)return Rs;if(!(me&&!Kt(Z)||!d)&&($||de))return ot.Transition.toString({...d,property:Zn})}}function Ds(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}P.Down,P.Right,P.Up,P.Left;const ks={collapsed:80,normal:200,expanded:400,fullscreen:0},js=80,Ts=800;function Is(e={}){const{initialMode:t="normal",sizes:n={},onModeChange:r}=e,o={...ks,...n},[s,i]=c.useState(t),[a,l]=c.useState(null),[d,p]=c.useState(!1),f=c.useRef(0),x=c.useRef(0),m=a??o[s],h=c.useCallback(y=>{i(y),l(null),r?.(y)},[r]),b=c.useCallback(()=>{h(s==="normal"?"expanded":"normal")},[s,h]),g=c.useCallback(()=>{const y=["collapsed","normal","expanded","fullscreen"],M=(y.indexOf(s)+1)%y.length;h(y[M])},[s,h]),C=c.useCallback(y=>{y.preventDefault(),p(!0),f.current=y.clientY,x.current=m},[m]),S=c.useCallback(y=>{if(!d)return;const v=f.current-y.clientY,M=Math.max(js,Math.min(Ts,x.current+v));l(M);const D=20;Object.entries(o).forEach(([N,T])=>{N!=="fullscreen"&&Math.abs(M-T)<D&&(l(T),i(N))})},[d,o]),R=c.useCallback(()=>{p(!1)},[]);return c.useEffect(()=>{const y=v=>{const M=document.activeElement;M?.tagName==="INPUT"||M?.tagName==="TEXTAREA"||M?.tagName==="SELECT"||((v.key==="t"||v.key==="T")&&(v.preventDefault(),b()),v.shiftKey&&(v.key==="t"||v.key==="T")&&(v.preventDefault(),h(s==="fullscreen"?"normal":"fullscreen")),v.key==="Escape"&&s==="fullscreen"&&(v.preventDefault(),h("normal")),(v.ctrlKey||v.metaKey)&&v.key==="ArrowUp"&&(v.preventDefault(),s==="collapsed"?h("normal"):s==="normal"?h("expanded"):s==="expanded"&&h("fullscreen")),(v.ctrlKey||v.metaKey)&&v.key==="ArrowDown"&&(v.preventDefault(),s==="fullscreen"?h("expanded"):s==="expanded"?h("normal"):s==="normal"&&h("collapsed")))};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[s,b,h]),c.useEffect(()=>{if(d)return window.addEventListener("mousemove",S),window.addEventListener("mouseup",R),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",R)}},[d,S,R]),{mode:s,height:m,isDragging:d,changeMode:h,toggle:b,cycle:g,handlers:{onDragStart:C},sizes:o}}const xn=e=>{let t;const n=new Set,r=(d,p)=>{const f=typeof d=="function"?d(t):d;if(!Object.is(f,t)){const x=t;t=p??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(m=>m(t,x))}},o=()=>t,a={setState:r,getState:o,getInitialState:()=>l,subscribe:d=>(n.add(d),()=>n.delete(d))},l=t=e(r,o,a);return a},Ps=(e=>e?xn(e):xn),As=e=>e;function Bs(e,t=As){const n=q.useSyncExternalStore(e.subscribe,q.useCallback(()=>t(e.getState()),[e,t]),q.useCallback(()=>t(e.getInitialState()),[e,t]));return q.useDebugValue(n),n}const Sn=e=>{const t=Ps(e),n=r=>Bs(t,r);return Object.assign(n,t),n},Qn=(e=>e?Sn(e):Sn),Os=e=>(t,n,r)=>{const o=r.subscribe;return r.subscribe=((i,a,l)=>{let d=i;if(a){const p=l?.equalityFn||Object.is;let f=i(r.getState());d=x=>{const m=i(x);if(!p(f,m)){const h=f;a(f=m,h)}},l?.fireImmediately&&a(f,f)}return o(d)}),e(t,n,r)},zs=Os;function Ls(e,t){let n;try{n=e()}catch{return}return{getItem:o=>{var s;const i=l=>l===null?null:JSON.parse(l,void 0),a=(s=n.getItem(o))!=null?s:null;return a instanceof Promise?a.then(i):i(a)},setItem:(o,s)=>n.setItem(o,JSON.stringify(s,void 0)),removeItem:o=>n.removeItem(o)}}const Ht=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(r){return Ht(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return Ht(r)(n)}}}},_s=(e,t)=>(n,r,o)=>{let s={storage:Ls(()=>window.localStorage),partialize:g=>g,version:0,merge:(g,C)=>({...C,...g}),...t},i=!1,a=0;const l=new Set,d=new Set;let p=s.storage;if(!p)return e((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...g)},r,o);const f=()=>{const g=s.partialize({...r()});return p.setItem(s.name,{state:g,version:s.version})},x=o.setState;o.setState=(g,C)=>(x(g,C),f());const m=e((...g)=>(n(...g),f()),r,o);o.getInitialState=()=>m;let h;const b=()=>{var g,C;if(!p)return;const S=++a;i=!1,l.forEach(y=>{var v;return y((v=r())!=null?v:m)});const R=((C=s.onRehydrateStorage)==null?void 0:C.call(s,(g=r())!=null?g:m))||void 0;return Ht(p.getItem.bind(p))(s.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==s.version){if(s.migrate){const v=s.migrate(y.state,y.version);return v instanceof Promise?v.then(M=>[!0,M]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var v;if(S!==a)return;const[M,D]=y;if(h=s.merge(D,(v=r())!=null?v:m),n(h,!0),M)return f()}).then(()=>{S===a&&(R?.(h,void 0),h=r(),i=!0,d.forEach(y=>y(h)))}).catch(y=>{S===a&&R?.(void 0,y)})};return o.persist={setOptions:g=>{s={...s,...g},g.storage&&(p=g.storage)},clearStorage:()=>{p?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>b(),hasHydrated:()=>i,onHydrate:g=>(l.add(g),()=>{l.delete(g)}),onFinishHydration:g=>(d.add(g),()=>{d.delete(g)})},s.skipHydration||b(),h||m},$s=_s,te={CREATE_PROGRESSION:"/live/create_progression",GET_TRANSPORT:"/live/get_transport",GET_TRACKS:"/live/get_tracks",SET_TEMPO:"/live/set_tempo",PLAY:"/live/play",PAUSE:"/live/pause",STOP:"/live/stop",JUMP_BY:"/live/jump_by",JUMP_TO:"/live/jump_to",TRANSPORT_UPDATE:"/live/transport",TRACK_INFO:"/live/track_info",HANDSHAKE:"/live/handshake",RESPONSE:"/live/response",ERROR:"/live/error"};let Mt=null,Oe=new Map,ze=!1;async function Fs(e,t=11e3,n=11001){if(ze)return!0;try{return e||(window.electronAPI.onOSCMessage(r=>{qs(r)}),await window.electronAPI.sendOSC("/chordgen/initialize",[])),ze=!0,console.log("[OSC Renderer] Initialized successfully"),Hs(),ze}catch(r){return console.error("[OSC Renderer] Failed to initialize:",r),!1}}function Hs(){Ce(te.HANDSHAKE,{version:"1.0.0",clientId:"chordgen-pro"})}function qs(e){const{address:t,args:n}=e;console.log("[OSC Renderer] Received:",t,n);const r=Oe.get(t);r&&r.forEach(s=>s(n));const o=Oe.get("*");o&&o.forEach(s=>s({address:t,args:n}))}function ut(e,t){return Oe.has(e)||Oe.set(e,[]),Oe.get(e).push(t),()=>{const n=Oe.get(e);if(n){const r=n.indexOf(t);r>-1&&n.splice(r,1)}}}function Ce(e,t){if(!ze){console.warn("[OSC Renderer] Not initialized");return}try{const n=Array.isArray(t)?t:[t];Mt?Mt.sendOSC(e,n):window.electronAPI.sendOSC(e,n)}catch(n){console.error("[OSC Renderer] Send failed:",n)}}function Ws(e,t=0,n){const r=[];let o=0;e.forEach(s=>{s.notes.forEach(i=>{r.push({pitch:i,startTime:o,duration:s.duration,velocity:100})}),o+=s.duration}),Ce(te.CREATE_PROGRESSION,{trackIndex:t,startBeat:n??-1,notes:r})}function wn(){Ce(te.GET_TRANSPORT,[])}function Cn(){Ce(te.GET_TRACKS,[])}function Us(e){Ce(te.SET_TEMPO,[e])}function Vs(){Ce(te.PLAY,[])}function Ks(){Ce(te.PAUSE,[])}function Xs(){Ce(te.STOP,[])}function Ys(e){Ce(te.JUMP_BY,[e])}function Js(e){Ce(te.JUMP_TO,[e])}function Gs(){if(ze)try{Mt?Mt.sendOSC("/chordgen/close",[]):window.electronAPI.sendOSC("/chordgen/close",[]),ze=!1,Oe.clear(),console.log("[OSC Renderer] Connection closed")}catch(e){console.error("[OSC Renderer] Close failed:",e)}}function Ge(){return ze}const nt=Qn()(zs((e,t)=>({isConnected:!1,transport:{isPlaying:!1,currentBeat:0,tempo:120},tracks:[],selectedTrackIndex:0,initializeOSC:async()=>{const n=await Fs();return n&&(ut(te.TRANSPORT_UPDATE,r=>{e({transport:{isPlaying:r[0]===1,currentBeat:r[1],tempo:r[2]}})}),ut(te.TRACK_INFO,r=>{const o=r[0],s=r[1],i=r[2];e(a=>{const l=[...a.tracks],d=l.findIndex(p=>p.index===o);return d>=0?l[d]={index:o,name:s,color:i}:l.push({index:o,name:s,color:i}),{tracks:l}})}),ut(te.RESPONSE,r=>{const o=r[0]===1,s=r[1];console.log("Live Response:",o?"Success":"Error",s)}),ut(te.ERROR,r=>{const o=r[0];console.error("Live Error:",o)}),wn(),Cn(),e({isConnected:!0})),n},createProgression:(n,r,o)=>{const{selectedTrackIndex:s}=t();Ws(n,r??s,o)},requestTransportState:()=>{wn()},requestTrackList:()=>{Cn()},setTempo:n=>{Us(n),e(r=>({transport:{...r.transport,tempo:n}}))},selectTrack:n=>{e({selectedTrackIndex:n})},disconnect:()=>{Gs(),e({isConnected:!1,tracks:[]})},play:()=>{e(n=>({transport:{...n.transport,isPlaying:!0}})),Ge()&&Vs()},pause:()=>{e(n=>({transport:{...n.transport,isPlaying:!1}})),Ge()&&Ks()},stop:()=>{e(n=>({transport:{...n.transport,isPlaying:!1,currentBeat:0}})),Ge()&&Xs()},jumpByBars:n=>{Ge()?Ys(n):e(r=>({transport:{...r.transport,currentBeat:Math.max(0,r.transport.currentBeat+n*4)}}))},jumpToBeat:n=>{Ge()?Js(n):e(r=>({transport:{...r.transport,currentBeat:Math.max(0,n)}}))}}))),z={playing:!1,beat:0,rafId:null,lastTime:null,listeners:new Set};function Ot(){const e={playing:z.playing,beat:z.beat};z.listeners.forEach(t=>t(e))}function Zs(e={}){const{pixelsPerBeat:t=40,totalBeats:n=0}=e,r=nt(h=>h.transport),o=nt(h=>h.isConnected),s=e.transport??r,i=e.isConnected??o,[a,l]=c.useState({playing:z.playing,beat:z.beat});c.useEffect(()=>{const h=b=>{l(b)};return z.listeners.add(h),h({playing:z.playing,beat:z.beat}),()=>{z.listeners.delete(h)}},[]);const d=c.useCallback(()=>{z.playing=!1,z.rafId&&(cancelAnimationFrame(z.rafId),z.rafId=null),z.lastTime=null,Ot()},[]),p=c.useCallback(()=>{if(i||(z.playing=!0,Ot(),z.rafId))return;const h=b=>{if(!z.playing){z.rafId=null;return}z.lastTime==null&&(z.lastTime=b);const g=b-z.lastTime;z.lastTime=b;const S=(e.transport?.tempo??nt.getState().transport?.tempo??120)/6e4,R=g*S;z.beat+=R,Ot(),z.rafId=requestAnimationFrame(h)};z.rafId=requestAnimationFrame(h)},[i]);c.useEffect(()=>{i&&a.playing&&d()},[i,a.playing,d]);const f=i?s.currentBeat:a.beat,x=i?s.isPlaying:a.playing,m=n>0?f%n*t:f*t;return{currentBeat:f,isPlaying:x,playheadX:m,startMock:p,stopMock:d,mockActive:a.playing}}function Qs(e={}){const{zoom:t=.45,minPx:n=10,maxPx:r=48,fitToView:o=!1,totalBeats:s=0,viewportWidth:i=800,minVisibleBeats:a=6,padding:l=48}=e,d=Math.pow(t,.8),p=Math.round(n+(r-n)*d);if(!s)return p;if(o){const x=Math.floor(Math.max(4,(i-l)/s));return Math.max(4,Math.min(p,x))}const f=Math.max(12,Math.floor((i-l)/a));return Math.max(4,Math.min(p,f))}const Rn={Maj:[0,4,7],min:[0,3,7],dim:[0,3,6],aug:[0,4,8],sus2:[0,2,7],sus4:[0,5,7],Maj7:[0,4,7,11],min7:[0,3,7,10],dom7:[0,4,7,10],dim7:[0,3,6,9],hdim7:[0,3,6,10],minMaj7:[0,3,7,11],aug7:[0,4,8,10],Maj9:[0,4,7,11,14],min9:[0,3,7,10,14],dom9:[0,4,7,10,14],Maj11:[0,4,7,11,14,17],min11:[0,3,7,10,14,17],dom11:[0,4,7,10,14,17],Maj13:[0,4,7,11,14,17,21],min13:[0,3,7,10,14,17,21],dom13:[0,4,7,10,14,17,21]};function ei(e,t){return(Rn[t]||Rn.Maj).map(r=>e+r)}function ti(e,t){if(!e||e.length===0||t===0)return[...e];const n=[...e].sort((o,s)=>o-s),r=[...n];for(let o=0;o<t&&o<n.length;o++)r[o]+=12;return r.sort((o,s)=>o-s)}function ni(e,t){if(!e||e.length<4||t===0)return[...e];const n=[...e].sort((o,s)=>o-s),r=[...n];return t===2&&n.length>=4?r[n.length-2]-=12:t===3&&n.length>=4?r[n.length-3]-=12:t===23&&n.length>=4&&(r[n.length-2]-=12,n.length>=4&&(r[n.length-4]-=12)),r.sort((o,s)=>o-s)}function ri(e,t=0,n=0){let r=[...e];return t>0&&(r=ti(r,t)),n>0&&(r=ni(r,n)),r}function oi(e){return{1:0,b2:1,2:2,b3:3,3:4,4:5,"#4":6,b5:6,5:7,"#5":8,b6:8,6:9,b7:10,7:11}[e]??0}function er(e){return((oi(e)||0)%12+12)%12}const si=[{id:"pop_1-5-6-4",name:"I-V-vi-IV (Pop Cadence)",description:"Classic pop progression with a hopeful resolution",degrees:["1","5","6","4"],qualities:["Maj","Maj","min","Maj"],semitones:[0,7,9,5],duration:4},{id:"sensitive_vi-iv-i-v",name:"vi-IV-I-V (Sensitive Loop)",description:"Emotionally charged loop used in ballads",degrees:["6","4","1","5"],qualities:["min","Maj","Maj","Maj"],semitones:[9,5,0,7],duration:4},{id:"50s_i-vi-ii-v",name:"I-vi-ii-V (50s Turnaround)",description:"Jazz/blues turnaround popular in classic progressions",degrees:["1","6","2","5"],qualities:["Maj","min","min","Maj"],semitones:[0,9,2,7],duration:4},{id:"jazz_ii-v-i",name:"ii-V-I (Jazz Cadence)",description:"The most common progression in jazz",degrees:["2","5","1"],qualities:["min7","dom7","Maj7"],semitones:[2,7,0],duration:4},{id:"blues_12bar",name:"I-IV-I-V (12-Bar Blues)",description:"Foundation of blues music",degrees:["1","4","1","5"],qualities:["dom7","dom7","dom7","dom7"],semitones:[0,5,0,7],duration:4},{id:"andalusian_cadence",name:"vi-V-IV-III (Andalusian)",description:"Descending progression common in flamenco",degrees:["6","5","4","3"],qualities:["min","Maj","Maj","Maj"],semitones:[9,7,5,4],duration:4},{id:"circle_of_fifths",name:"vi-ii-V-I (Circle Progression)",description:"Follows the circle of fifths",degrees:["6","2","5","1"],qualities:["min7","min7","dom7","Maj7"],semitones:[9,2,7,0],duration:4}].map(e=>({...e,semitones:e.degrees.map(t=>er(t))})),ii=si;function tr(e="New Section"){return{id:crypto.randomUUID(),name:e,progression:[],repeats:1,beatsPerBar:4,rootHeld:null,currentNotes:[],transitions:{type:"none",length:2}}}function Mn(e){return{id:e.id,name:e.name,progression:kt(e.progression),rootHeld:e.rootHeld,repeats:e.repeats||1,beatsPerBar:e.beatsPerBar||4,currentNotes:Array.isArray(e.currentNotes)?[...e.currentNotes]:[],transitions:{...e.transitions}}}function kt(e=[]){return e.map(t=>({notes:Array.isArray(t.notes)?[...t.notes]:[],duration:t.duration,metadata:t.metadata?{...t.metadata}:void 0}))}function nr(e=[]){return[...ii,...e]}function ai(e,t=[]){const n=e?.toLowerCase();if(n)return nr(t).find(r=>r.id.toLowerCase()===n||r.name.toLowerCase()===n)}function ci(e,t={},n=[]){const r=ai(e,n);if(!r)return null;const o=t.root??60,s=t.duration??r.duration??4,i=t.inversion??0,a=t.drop??0;return r.degrees.map((l,d)=>{const p=r.qualities?.[d]||r.defaultQuality||"Maj",f=o+er(l);let x=ei(f,p);return(i!==0||a!==0)&&(x=ri(x,i,a)),{notes:x,duration:s,metadata:{root:f,quality:p,degree:parseInt(l)||void 0,inversion:i,drop:a}}})}function li(e,t,n={}){return{name:e,progression:kt(t),metadata:{savedAt:Date.now(),...n}}}function ui(e){return kt(e.progression)}const En={keyRoot:60,mode:"Ionian",selectedSlot:null,sections:[tr("Section 1")],currentSectionIndex:0,customPatterns:[],savedProgressions:{}},rr=Qn()($s((e,t)=>({...En,setKeyRoot:n=>{e({keyRoot:n})},setMode:n=>{e({mode:n})},selectSlot:n=>{e({selectedSlot:n})},getCurrentSection:()=>{const{sections:n,currentSectionIndex:r}=t();return n[r]||n[0]},openDrawer:null,setOpenDrawer:n=>{e(()=>({openDrawer:n}))},loadSection:n=>{const{sections:r}=t();n>=0&&n<r.length&&e({currentSectionIndex:n})},updateCurrentSection:n=>{const{sections:r,currentSectionIndex:o}=t(),s=[...r];s[o]=Mn(n),e({sections:s})},moveSection:n=>{const{sections:r,currentSectionIndex:o}=t(),s=Math.max(0,Math.min(r.length-1,o+n));e({currentSectionIndex:s})},createSection:n=>{const{sections:r}=t(),o=n||`Section ${r.length+1}`,s=tr(o);e({sections:[...r,s],currentSectionIndex:r.length})},deleteSection:n=>{const{sections:r,currentSectionIndex:o}=t();if(r.length<=1)return;const s=r.filter((a,l)=>l!==n),i=o>=s.length?s.length-1:o;e({sections:s,currentSectionIndex:i})},renameSection:n=>{const{sections:r,currentSectionIndex:o}=t(),s=[...r];s[o]={...s[o],name:n},e({sections:s})},renameSectionAt:(n,r)=>{const{sections:o}=t();if(n<0||n>=o.length)return;const s=[...o];s[n]={...s[n],name:r},e({sections:s})},reorderSection:(n,r)=>{const{sections:o,currentSectionIndex:s}=t();if(n===r||n<0||n>=o.length||r<0||r>=o.length)return;const i=[...o],[a]=i.splice(n,1);i.splice(r,0,a);let l=s;s===n?l=r:n<s&&r>=s?l=s-1:n>s&&r<=s&&(l=s+1),e({sections:i,currentSectionIndex:l})},duplicateSection:n=>{const{sections:r}=t();if(n<0||n>=r.length)return;const o=r[n],s={...Mn(o),id:crypto.randomUUID(),name:`${o.name} (Copy)`},i=[...r.slice(0,n+1),s,...r.slice(n+1)];e({sections:i})},addChord:n=>{const r=t().getCurrentSection(),o={...r,progression:[...r.progression,n]};t().updateCurrentSection(o)},removeChord:n=>{const r=t().getCurrentSection(),o={...r,progression:r.progression.filter((s,i)=>i!==n)};t().updateCurrentSection(o)},updateChord:(n,r)=>{const o=t().getCurrentSection(),s=[...o.progression];s[n]=r;const i={...o,progression:s};t().updateCurrentSection(i)},insertChord:(n,r)=>{const o=t().getCurrentSection(),s=[...o.progression];s.splice(n,0,r);const i={...o,progression:s};t().updateCurrentSection(i)},clearProgression:()=>{const r={...t().getCurrentSection(),progression:[]};t().updateCurrentSection(r)},setProgression:n=>{const o={...t().getCurrentSection(),progression:kt(n)};t().updateCurrentSection(o)},addCustomPattern:n=>{const{customPatterns:r}=t(),o=r.some(s=>s.id===n.id);e(o?{customPatterns:r.map(s=>s.id===n.id?n:s)}:{customPatterns:[...r,n]})},removeCustomPattern:n=>{const{customPatterns:r}=t();e({customPatterns:r.filter(o=>o.id!==n)})},getAllPatterns:()=>{const{customPatterns:n}=t();return nr(n)},applyPatternToSection:(n,r=60)=>{const{customPatterns:o}=t(),s=ci(n,{root:r},o);s&&t().setProgression(s)},saveProgression:(n,r)=>{const o=t().getCurrentSection(),s=li(n,o.progression,r),{savedProgressions:i}=t();e({savedProgressions:{...i,[n]:s}})},loadProgression:n=>{const{savedProgressions:r}=t(),o=r[n];if(o){const s=ui(o);t().setProgression(s)}},deleteProgression:n=>{const{savedProgressions:r}=t(),o={...r};delete o[n],e({savedProgressions:o})},getSavedProgressionNames:()=>{const{savedProgressions:n}=t();return Object.keys(n).sort()},reset:()=>{e(En)}}),{name:"progression-storage",partialize:e=>({keyRoot:e.keyRoot,mode:e.mode,sections:e.sections,currentSectionIndex:e.currentSectionIndex,customPatterns:e.customPatterns,savedProgressions:e.savedProgressions})}));(()=>{try{const e=["progression-storage","zustand:progression-storage"];for(const t of e){const n=localStorage.getItem(t);if(!n)continue;let r;try{r=JSON.parse(n)}catch{continue}const o=r.state??r;if(!o||!Array.isArray(o.sections)||!o.sections.some(a=>!a||!a.id))continue;o.sections=o.sections.map(a=>({...a||{},id:a?.id??crypto.randomUUID()}));const i=r.state?{...r,state:o}:o;localStorage.setItem(t,JSON.stringify(i));break}}catch(e){console.warn("progressionStore: failed to sanitize persisted sections",e)}})();const or=e=>["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12],sr=e=>e.progression.reduce((t,n)=>t+n.duration,0),Zt=e=>Math.max(1,e.repeats||1),qt=e=>sr(e)*Zt(e),di=e=>{const t=Math.max(0,e),n=Math.floor(t/60),r=Math.floor(t%60);return`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`};let Nn=!1;const Dn=.02,kn=1,fi=.12,pi=2;function mi({section:e,index:t,pixelsPerBeat:n,getActiveBeatInSection:r,markUserInteraction:o}){const s=sr(e),i=Zt(e),a=s*i,l=a*n,d=r(t),p=Array.from({length:i}).flatMap((S,R)=>e.progression.map((y,v)=>({chord:y,key:`${R}-${v}`}))),{attributes:f,listeners:x,setNodeRef:m,transform:h,transition:b,isDragging:g}=Ns({id:String(e.id)}),C={transform:ot.Transform.toString(h)||void 0,transition:b,width:`${l}px`,minWidth:`${l}px`};return u.jsxs("div",{ref:m,...f,className:`section-card ${g?"dragging":""}`,style:C,onMouseDown:o,children:[u.jsx("div",{className:"duration-indicator",children:Array.from({length:Math.ceil(a)}).map((S,R)=>u.jsx("div",{className:`duration-beat ${R===d?"active":""}`,style:{width:`${n}px`}},R))}),u.jsxs("div",{className:"section-card-content",children:[u.jsx("div",{className:"drag-handle",...x}),u.jsxs("div",{className:"section-header",children:[u.jsx("span",{className:"section-name",children:e.name}),u.jsx("div",{className:"section-controls",children:u.jsx("button",{className:"edit-btn",title:"Edit section",children:u.jsx(Tn,{size:12})})})]}),u.jsx("div",{className:"progression-chords",children:p.map(({chord:S,key:R})=>{const y=S.duration*n,v=S.metadata?.root!==void 0?or(S.metadata.root):"",M=S.metadata?.quality||"?",D=v?`${v}${M}`:M;return u.jsx("div",{className:"chord-card",style:{width:`${y}px`},children:u.jsxs("div",{className:"chord-label",children:[u.jsx("span",{className:"chord-name",children:D}),u.jsxs("span",{className:"chord-duration",children:[S.duration,"b"]})]})},R)})}),u.jsx("div",{className:"section-detail-expanded",children:u.jsxs("div",{className:"section-meta",children:[u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{className:"repeat-badge",children:["",i]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[Math.ceil(a/(e?.beatsPerBar||4))," ","bars"]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[e.progression.length*i," chords"]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[a," beats"]})})]})})]})]})}const hi=c.memo(function({sections:t,pixelsPerBeat:n,getActiveBeatInSection:r,handleDragEnd:o,onDragStart:s,onDragEnd:i,markUserInteraction:a,disableDrag:l,onVelocityDragStart:d,onGateToggle:p}){const f=t.map(m=>String(m.id)),x=(m,h,b)=>{const g=qt(m),C=Zt(m),S=g*n,R=r(h),y=Array.from({length:C}).flatMap((v,M)=>m.progression.map((D,N)=>({chord:D,key:`${M}-${N}`})));return u.jsxs("div",{className:"section-card static-section",style:{width:`${S}px`,minWidth:`${S}px`},children:[u.jsx("div",{className:"duration-indicator",children:Array.from({length:Math.ceil(g||0)}).map((v,M)=>u.jsx("div",{className:`duration-beat ${M===R?"active":""}`,style:{width:`${n}px`}},M))}),u.jsxs("div",{className:"section-card-content",children:[u.jsxs("div",{className:"section-header",children:[u.jsx("span",{className:"section-name",children:m?.name||"Unnamed"}),u.jsx("div",{className:"section-controls",children:u.jsx("button",{className:"edit-btn",title:"Edit section",children:u.jsx(Tn,{size:12})})})]}),u.jsx("div",{className:"progression-chords",children:y.map(({chord:v,key:M})=>{const D=v.duration*n,N=v.metadata?.root!==void 0?or(v.metadata.root):"",T=v.metadata?.quality||"?",I=N?`${N}${T}`:T;return u.jsx("div",{className:"chord-card",style:{width:`${D}px`},children:u.jsxs("div",{className:"chord-label",children:[u.jsx("span",{className:"chord-name",children:I}),u.jsxs("span",{className:"chord-duration",children:[v.duration,"b"]})]})},M)})}),u.jsx("div",{className:"section-detail-expanded",children:u.jsxs("div",{className:"section-meta",children:[u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{className:"repeat-badge",children:["",C]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[Math.ceil(g/(m?.beatsPerBar||4))," ","bars"]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[(m?.progression?.length||0)*C," chords"]})}),u.jsx("div",{className:"section-meta-item",children:u.jsxs("span",{children:[g," beats"]})})]})})]})]},b||m?.id||`section-static-${h}`)};return l?u.jsxs("div",{className:"timeline-scroll-container",onMouseDown:a,onTouchStart:a,onWheel:a,onScroll:a,children:[u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--prev","aria-hidden":"true"}),t.map((m,h)=>x(m,h,`section-static-prev-${h}`)),u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--middle","aria-hidden":"true"}),t.map((m,h)=>x(m,h,`section-static-${h}`)),u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--next","aria-hidden":"true"}),t.map((m,h)=>x(m,h,`section-static-next-${h}`))]}):u.jsx(ls,{collisionDetection:lo,onDragStart:()=>s?.(),onDragEnd:m=>{const{active:h,over:b}=m;if(!b){i?.();return}const g=t.findIndex(S=>String(S.id)===String(h.id)),C=t.findIndex(S=>String(S.id)===String(b.id));g!==-1&&C!==-1&&g!==C&&o(g,C),i?.()},children:u.jsx(xs,{items:f,strategy:Gt,children:u.jsxs("div",{className:"timeline-scroll-container",onMouseDown:a,onTouchStart:a,onWheel:a,onScroll:a,children:[u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--prev","aria-hidden":"true"}),t.map((m,h)=>x(m,h,`section-prev-${h}`)),u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--middle","aria-hidden":"true"}),t.map((m,h)=>!m||!m.id?(Nn||(console.warn("[Timeline] section missing id  rendering non-draggable fallback. Fix section ids to re-enable drag/drop.",{index:h,section:m}),Nn=!0),x(m,h,`section-fallback-${h}`)):u.jsx(mi,{section:m,index:h,pixelsPerBeat:n,getActiveBeatInSection:r,markUserInteraction:a,onVelocityDragStart:d,onGateToggle:p},String(m.id))),u.jsx("div",{className:"timeline-song-start-marker timeline-song-start-marker--next","aria-hidden":"true"}),t.map((m,h)=>x(m,h,`section-next-${h}`))]})})})});function ir(){const{sections:e,reorderSection:t}=rr(),{play:n,pause:r,jumpByBars:o,jumpToBeat:s,isConnected:i,transport:a}=nt(),{mode:l,height:d,isDragging:p,changeMode:f,toggle:x,handlers:m}=Is({initialMode:"normal",onModeChange:w=>{console.log("Timeline mode changed:",w)}}),h=c.useRef(null),b=c.useRef(null),g=c.useRef(!1),C=c.useRef(0),S=c.useRef(0),R=c.useRef(!1),y=c.useRef({ready:!1,prevStart:0,middleStart:0,nextStart:0,cycleSpan:1}),v=c.useRef(0),M=c.useRef(0),D=c.useRef(null),N=c.useRef(0),T=c.useRef(0),I=c.useMemo(()=>{let w=0;return e.map(k=>{const j=w,O=qt(k);return w+=O,{startBeat:j,endBeat:w,totalBeats:O}})},[e]),E=c.useMemo(()=>I.length>0?I[I.length-1].endBeat:0,[I]),[Z,X]=c.useState(.45),ce=h.current?.parentElement?.clientWidth??h.current?.clientWidth??800,V=Qs({zoom:Z,minPx:l==="collapsed"?8:10,maxPx:60,fitToView:!1,totalBeats:E,viewportWidth:ce}),{currentBeat:W,isPlaying:B,startMock:Pe,stopMock:le,mockActive:ge}=Zs({pixelsPerBeat:V,totalBeats:E}),{currentBar:Me,currentBeatInBar:$}=c.useMemo(()=>{if(E<=0||I.length===0)return{currentBar:1,currentBeatInBar:1};const w=(W%E+E)%E,k=I.findIndex(ee=>w>=ee.startBeat&&w<ee.endBeat);if(k<0)return{currentBar:1,currentBeatInBar:1};const O=e[k]?.beatsPerBar||4,F=w-I[k].startBeat,J=Math.floor(F/O)+1,L=Math.floor(F%O)+1;return{currentBar:e.slice(0,k).reduce((ee,ye)=>{const oe=qt(ye);return ee+Math.ceil(oe/(ye.beatsPerBar||4))},0)+J,currentBeatInBar:L}},[W,I,e,E]);c.useEffect(()=>{M.current=W},[W]);const[ue,me]=c.useState(!1),ve=c.useRef(null),Y=c.useCallback(()=>{me(!0),ve.current&&window.clearTimeout(ve.current),ve.current=window.setTimeout(()=>{me(!1),ve.current=null},1e3)},[]),Ee=c.useCallback(w=>{const k=h.current;if(!k||E<=0)return null;const j=k.clientWidth,O=y.current.ready?y.current.middleStart:j/2,F=y.current.ready?Math.max(1,y.current.cycleSpan):Math.max(1,E*V),J=E*V,be=Math.max(0,F-J)/V,ee=Math.max(0,w),ye=E>0?Math.floor(ee/E):0,oe=ee-ye*E,Ue=E>0?oe/E*be:0,Ve=ye*(E+be)+oe+Ue;return{rawTarget:O+Ve*V-j/2,viewportWidth:j,songCycleSpanPx:F}},[V,E]),Q=c.useCallback(()=>{const w=h.current;if(!w)return;const k=w.querySelector(".timeline-song-start-marker--prev"),j=w.querySelector(".timeline-song-start-marker--middle"),O=w.querySelector(".timeline-song-start-marker--next");if(!k||!j||!O){y.current.ready=!1;return}const F=j.offsetLeft,J=O.offsetLeft,L=k.offsetLeft;y.current={ready:!0,prevStart:L,middleStart:F,nextStart:J,cycleSpan:Math.max(1,J-F)}},[]);c.useEffect(()=>{Q();const w=()=>Q();return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[Q,e,V,l]),c.useEffect(()=>{const w=h.current;if(!w||R.current||(Q(),!y.current.ready))return;const k=w.clientWidth,j=Math.max(0,y.current.middleStart-k/2);w.scrollLeft=j,C.current=j,S.current=0,R.current=!0},[e,V,Q]),c.useEffect(()=>{const w=performance.now(),j=(a?.tempo||120)/6e4;if(D.current===null){v.current=W,D.current=W,N.current=v.current,T.current=w;return}let O=W-D.current;if(E>0){const L=Math.max(1,E*.5);O<-L&&(O+=E),O>L&&(O-=E)}v.current+=O,D.current=W;const F=N.current+(w-T.current)*j,J=v.current-F;Math.abs(J)>=pi?N.current=v.current:N.current=F+J*fi,T.current=w},[W,E,a]);const re=c.useCallback(()=>{if(!B)return N.current;const w=a?.tempo||120,k=Math.max(0,performance.now()-T.current);return N.current+k*(w/6e4)},[B,a]),A=c.useMemo(()=>{const w=a?.tempo||120,k=B?re():W,j=Math.max(0,k)*60/w;return di(j)},[W,re,B,a]);c.useEffect(()=>{const w=Ee(v.current);w!==null&&(C.current=w.rawTarget-S.current)},[Ee,W]),c.useEffect(()=>{const w=!!h.current&&E>0&&B&&!ue;if(g.current=w,!w){b.current&&(cancelAnimationFrame(b.current),b.current=null);return}const k=()=>{if(!g.current||!h.current){b.current=null;return}const j=h.current,O=re(),F=Ee(O);if(F!==null){let L=F.rawTarget-S.current;if(y.current.ready){const{middleStart:ee,nextStart:ye,cycleSpan:oe}=y.current,Ue=ee-oe,Ve=ye;for(;L>Ve;)S.current+=oe,L-=oe;for(;L<Ue;)S.current-=oe,L+=oe}const be=Math.max(0,j.scrollWidth-F.viewportWidth);C.current=Math.max(0,Math.min(L,be))}const J=C.current;j.scrollLeft=J,b.current=requestAnimationFrame(k)};return b.current||(b.current=requestAnimationFrame(k)),()=>{b.current&&(cancelAnimationFrame(b.current),b.current=null)}},[B,ue,E]),c.useEffect(()=>{B||(N.current=v.current,T.current=performance.now())},[B]),c.useEffect(()=>{const w=k=>{const j=document.activeElement;j&&(j.tagName==="INPUT"||j.tagName==="TEXTAREA")||(k.key==="t"||k.key==="T"?k.shiftKey?f("fullscreen"):x():k.key==="Escape"?f("normal"):k.key==="+"||k.key==="="?X(O=>Math.min(kn,+(O+.05).toFixed(2))):k.key==="-"&&X(O=>Math.max(Dn,+(O-.05).toFixed(2))))};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[x,f]);const Ae=c.useCallback(w=>{if(E===0)return-1;const k=M.current%E,j=I[w];return k>=j.startBeat&&k<j.endBeat?Math.floor(k-j.startBeat):-1},[E,I]),de=c.useCallback((w,k)=>{w!==k&&t(w,k)},[t]),Ne=hi;return u.jsxs(u.Fragment,{children:[l==="fullscreen"&&u.jsx("div",{className:"timeline-overlay-backdrop",onClick:()=>f("normal")}),u.jsxs("div",{className:`timeline-container ${l}`,style:{height:l==="fullscreen"?"100vh":`${d}px`},children:[u.jsx("div",{className:"timeline-resize-handle",onMouseDown:m.onDragStart,onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),m.onDragStart(w))},title:"Drag to resize timeline",role:"button","aria-label":"Resize timeline",tabIndex:0}),p&&u.jsxs("div",{className:"resize-tooltip",children:[Math.round(d)," px"]}),u.jsx("button",{className:"timeline-fullscreen-close",onClick:()=>f("normal"),title:"Exit fullscreen (Esc)",children:u.jsx($r,{size:20})}),u.jsxs("div",{className:"timeline-content",children:[u.jsxs("div",{className:"timeline-nav-strip",children:[u.jsxs("div",{className:"control-group",children:[u.jsx("span",{className:"control-label",children:"Zoom"}),u.jsx(Wr,{size:14,style:{color:"rgba(0, 0, 0, 0.5)"}}),u.jsx("input",{type:"range",min:Dn,max:kn,step:"0.01",value:Z,onChange:w=>X(Number(w.target.value)),className:"zoom-slider",title:"Zoom level"}),u.jsx(Hr,{size:14,style:{color:"rgba(0, 0, 0, 0.5)"}}),u.jsxs("span",{className:"zoom-display",children:[V,"px/b"]})]}),u.jsxs("div",{className:"timeline-size-presets",children:[u.jsx("button",{className:`size-preset-btn ${l==="collapsed"?"active":""}`,onClick:()=>f("collapsed"),title:"Collapsed view",children:u.jsx(Mr,{size:14})}),u.jsx("button",{className:`size-preset-btn ${l==="normal"?"active":""}`,onClick:()=>f("normal"),title:"Normal view",children:u.jsx(Lr,{size:14})}),u.jsx("button",{className:`size-preset-btn ${l==="expanded"?"active":""}`,onClick:()=>f("expanded"),title:"Expanded view",children:u.jsx(Sr,{size:14})}),u.jsx("button",{className:`size-preset-btn ${l==="fullscreen"?"active":""}`,onClick:()=>f("fullscreen"),title:"Fullscreen view",children:u.jsx(Cr,{size:14})})]})]}),u.jsxs("div",{className:"timeline-track-wrapper",children:[u.jsx("div",{className:"timeline-track",ref:h,children:u.jsx(Ne,{sections:e,pixelsPerBeat:V,getActiveBeatInSection:Ae,handleDragEnd:de,onDragStart:()=>me(!0),onDragEnd:()=>Y(),markUserInteraction:Y})}),u.jsx("div",{className:"playhead-dial","data-position":`${Me}:${$}`,"aria-live":"polite","aria-label":`Playhead at bar ${Me}, beat ${$}`})]}),u.jsxs("div",{className:"timeline-controls-panel",children:[u.jsxs("div",{className:"control-group",children:[u.jsx("button",{className:"transport-btn",onClick:()=>s(0),title:"Skip to start",children:u.jsx(Pr,{size:16})}),u.jsx("button",{className:"transport-btn",onClick:()=>o(-1),title:"Previous bar",children:u.jsx(Tr,{size:16})}),u.jsx("button",{className:`transport-btn ${B?"playing":""}`,onClick:()=>i?B?r():n():B?le():Pe(),title:B?"Pause":"Play",children:B?u.jsx(sn,{size:16}):u.jsx(an,{size:16})}),!i&&u.jsx("button",{className:`transport-btn dev ${ge?"playing":""}`,onClick:()=>ge?le():Pe(),title:ge?"Stop mock play":"Dev mock play",children:ge?u.jsx(sn,{size:12}):u.jsx(an,{size:12})}),u.jsx("button",{className:"transport-btn",onClick:()=>o(1),title:"Next bar",children:u.jsx(yr,{size:16})}),u.jsx("button",{className:"transport-btn",onClick:()=>s(E-1),title:"Skip to end",children:u.jsx(Br,{size:16})})]}),u.jsxs("div",{className:"position-display",children:[u.jsxs("span",{children:["Bar ",Me]}),u.jsx("span",{className:"position-separator",children:"|"}),u.jsxs("span",{children:["Beat ",$]}),u.jsx("span",{className:"position-separator",children:"|"}),u.jsx("span",{children:A})]}),u.jsx("div",{className:"control-group",children:u.jsx("button",{className:"transport-btn loop-toggle active",title:"Loop enabled",children:u.jsx(kr,{size:16})})}),u.jsxs("div",{className:"control-group",children:[u.jsx("span",{className:"control-label",children:"Snap"}),u.jsxs("label",{className:"checkbox-toggle",children:[u.jsx("input",{type:"radio",name:"snap",defaultChecked:!0}),u.jsx("span",{className:"checkbox-label",children:"Bar"})]}),u.jsxs("label",{className:"checkbox-toggle",children:[u.jsx("input",{type:"radio",name:"snap"}),u.jsx("span",{className:"checkbox-label",children:"Beat"})]})]}),u.jsxs("div",{className:"control-group",children:[u.jsxs("label",{className:"checkbox-toggle",children:[u.jsx("input",{type:"checkbox",defaultChecked:!0}),u.jsx("span",{className:"checkbox-label",children:"Buffer"})]}),u.jsx("input",{type:"number",min:"2",max:"8",defaultValue:"4",className:"buffer-input",title:"Pre-buffer bars"}),u.jsx("input",{type:"number",min:"2",max:"8",defaultValue:"4",className:"buffer-input",title:"Post-buffer bars"})]})]})]})]})]})}ir.__docgenInfo={description:"",methods:[],displayName:"LoopTimeline"};const gi=({tempo:e=120,isPlaying:t=!1,currentBeat:n=0,sections:r})=>(c.useEffect(()=>{rr.setState({sections:r}),nt.setState({transport:{isPlaying:t,currentBeat:n,tempo:e}})},[r,t,n,e]),u.jsx(ir,{})),Le=[{id:"verse-1",name:"Verse 1",progression:[{notes:[60,64,67],duration:2,metadata:{root:60,quality:"maj",velocities:[80,80,80],gate:[1,1,1],strum:[0,0,0],drop:0}},{notes:[62,65,69],duration:2,metadata:{root:62,quality:"min",velocities:[80,80,80],gate:[1,1,1],strum:[0,0,0],drop:0}}],repeats:2,beatsPerBar:4,transitions:{type:"none"},rootHeld:null,currentNotes:[]},{id:"chorus-1",name:"Chorus",progression:[{notes:[67,71,74],duration:1,metadata:{root:67,quality:"maj",velocities:[90,90,90],gate:[1,1,1],strum:[0,0,0],drop:0}},{notes:[69,72,76],duration:1,metadata:{root:69,quality:"min",velocities:[90,90,90],gate:[1,1,1],strum:[0,0,0],drop:0}},{notes:[65,69,72],duration:2,metadata:{root:65,quality:"dom",velocities:[85,85,85],gate:[1,1,1],strum:[0,0,0],drop:0}}],repeats:1,beatsPerBar:4,transitions:{type:"none"},rootHeld:null,currentNotes:[]}],Qt=[...Le,{id:"bridge",name:"Bridge",progression:[{notes:[70,74,77],duration:1.5,metadata:{root:70,quality:"dim",velocities:[75,75,75],gate:[1,1,1],strum:[0,0,0],drop:0}},{notes:[72,75,79],duration:2.5,metadata:{root:72,quality:"maj",velocities:[85,85,85],gate:[1,1,1],strum:[0,0,0],drop:0}}],repeats:1,beatsPerBar:4,transitions:{type:"none"},rootHeld:null,currentNotes:[]},{id:"outro",name:"Outro",progression:[{notes:[67,71,74],duration:4,metadata:{root:67,quality:"maj",velocities:[70,70,70],gate:[1,1,1],strum:[0,0,0],drop:0}}],repeats:3,beatsPerBar:4,transitions:{type:"none"},rootHeld:null,currentNotes:[]}],wi={title:"ProgressionEditor/LoopTimeline",component:gi,parameters:{layout:"fullscreen",docs:{description:{component:"Interactive timeline component for displaying and editing musical progressions with drag-and-drop sections."}}},decorators:[e=>u.jsx("div",{style:{height:"100vh",background:"#1a1a1a",padding:"20px"},children:u.jsx(e,{})})],argTypes:{zoomLevel:{control:{type:"range",min:.02,max:1,step:.01},description:"Timeline zoom level (0.02 = most zoomed out, 1 = most zoomed in)"},tempo:{control:{type:"range",min:60,max:200,step:1},description:"Playback tempo in BPM"},isPlaying:{control:{type:"boolean"},description:"Whether the timeline is currently playing"},currentBeat:{control:{type:"number",min:0,max:50,step:.1},description:"Current beat position in the timeline"},sections:{control:{type:"object"},description:"Array of progression sections to display"}}},dt={args:{sections:Le,tempo:120,isPlaying:!1,currentBeat:0}},ft={args:{sections:Le,tempo:120,isPlaying:!0,currentBeat:3.5}},pt={args:{sections:Le,tempo:120,isPlaying:!1,currentBeat:0},parameters:{docs:{description:"Timeline with higher zoom level showing more detail."}}},mt={args:{sections:Le,tempo:120,isPlaying:!1,currentBeat:0},parameters:{docs:{description:"Timeline with lower zoom level showing broader overview."}}},ht={args:{sections:Le,tempo:120,isPlaying:!1,currentBeat:2.5},parameters:{docs:{description:"Timeline showing an active beat indicator."}}},gt={args:{sections:Qt,tempo:120,isPlaying:!1,currentBeat:0},parameters:{docs:{description:"Timeline with a more complex progression including bridge and outro sections."}}},vt={args:{sections:Qt,tempo:140,isPlaying:!0,currentBeat:8.75},parameters:{docs:{description:"Fully interactive playground - adjust all controls to see dramatic changes!"}}},bt={args:{sections:Le,tempo:200,isPlaying:!0,currentBeat:1.25},parameters:{docs:{description:"Maximum zoom with fast tempo - see the finest details!"}}},yt={args:{sections:Qt,tempo:80,isPlaying:!1,currentBeat:0},parameters:{docs:{description:"Ultra-wide view showing the entire song structure."}}};dt.parameters={...dt.parameters,docs:{...dt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 120,
    isPlaying: false,
    currentBeat: 0
  }
}`,...dt.parameters?.docs?.source}}};ft.parameters={...ft.parameters,docs:{...ft.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 120,
    isPlaying: true,
    currentBeat: 3.5
  }
}`,...ft.parameters?.docs?.source}}};pt.parameters={...pt.parameters,docs:{...pt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 120,
    isPlaying: false,
    currentBeat: 0
  },
  parameters: {
    docs: {
      description: 'Timeline with higher zoom level showing more detail.'
    }
  }
}`,...pt.parameters?.docs?.source}}};mt.parameters={...mt.parameters,docs:{...mt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 120,
    isPlaying: false,
    currentBeat: 0
  },
  parameters: {
    docs: {
      description: 'Timeline with lower zoom level showing broader overview.'
    }
  }
}`,...mt.parameters?.docs?.source}}};ht.parameters={...ht.parameters,docs:{...ht.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 120,
    isPlaying: false,
    currentBeat: 2.5
  },
  parameters: {
    docs: {
      description: 'Timeline showing an active beat indicator.'
    }
  }
}`,...ht.parameters?.docs?.source}}};gt.parameters={...gt.parameters,docs:{...gt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSectionsComplex,
    tempo: 120,
    isPlaying: false,
    currentBeat: 0
  },
  parameters: {
    docs: {
      description: 'Timeline with a more complex progression including bridge and outro sections.'
    }
  }
}`,...gt.parameters?.docs?.source}}};vt.parameters={...vt.parameters,docs:{...vt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSectionsComplex,
    tempo: 140,
    isPlaying: true,
    currentBeat: 8.75
  },
  parameters: {
    docs: {
      description: 'Fully interactive playground - adjust all controls to see dramatic changes!'
    }
  }
}`,...vt.parameters?.docs?.source}}};bt.parameters={...bt.parameters,docs:{...bt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSections,
    tempo: 200,
    isPlaying: true,
    currentBeat: 1.25
  },
  parameters: {
    docs: {
      description: 'Maximum zoom with fast tempo - see the finest details!'
    }
  }
}`,...bt.parameters?.docs?.source}}};yt.parameters={...yt.parameters,docs:{...yt.parameters?.docs,source:{originalSource:`{
  args: {
    sections: mockSectionsComplex,
    tempo: 80,
    isPlaying: false,
    currentBeat: 0
  },
  parameters: {
    docs: {
      description: 'Ultra-wide view showing the entire song structure.'
    }
  }
}`,...yt.parameters?.docs?.source}}};const Ci=["Default","Playing","HighZoom","LowZoom","WithActiveBeat","ComplexProgression","Playground","ExtremeZoom","WideView"];export{gt as ComplexProgression,dt as Default,bt as ExtremeZoom,pt as HighZoom,mt as LowZoom,vt as Playground,ft as Playing,yt as WideView,ht as WithActiveBeat,Ci as __namedExportsOrder,wi as default};
